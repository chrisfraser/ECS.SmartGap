<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no;" />
        <title>
        </title>
        <link rel="stylesheet" href="content/jquery.mobile-1.1.0.min.css" />
        <link rel="stylesheet" href="content/my.css" />
        <style>
            /* App custom styles */
        </style>

        <script src="phonegap.js"></script>
        <script src="scripts/jquery-1.7.2.min.js"></script>
        <script src="scripts/jquery.mobile-1.1.0.min.js"></script>
    </head>
    <body>
        <div data-role="page" id="pageHome">
            <div data-theme="a" data-role="header">
                <h3>
                    SmartGap
                </h3>
            </div>
            <div data-role="content">
                <ul data-role="listview" data-divider-theme="b" data-inset="true">
                    <li data-role="list-divider" role="heading">
                        Menu
                    </li>
                    <li data-theme="c">
                        <a href="#pageDeviceStatus" data-transition="slide">
                            Device Status
                        </a>
                    </li>
                    <li data-theme="c">
                        <a href="#page3" data-transition="slide">
                            Map
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div data-role="page" id="pageDeviceStatus">
            <div data-theme="a" data-role="header" data-position="fixed">
                <a href="#pageHome" data-transition="fade" data-icon="home" data-iconpos="notext">Home</a>
                <h3>
                    Device Status
                </h3>
                <a href="#" id="updateDeviceStatus" data-icon="refresh">Update</a>
            </div>
            <div data-role="content">
                <div data-role="collapsible-set" data-theme="b" data-content-theme="">
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>Device</h3>
                        <p id="deviceProperties">Loading device properties...</p>
                    </div>
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>
                            Connectivity
                        </h3>
                        <p id="deviceConnectivity">Loading device connectivity...</p>
                    </div>
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>
                            GPS
                        </h3>
                        <p id="deviceGPS">Loading device GPS...</p>
                    </div>
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>
                            Accelerometer
                        </h3>
                        <p id="deviceAccelerometer">Loading device Accelerometer...</p>
                    </div>
                    <div data-role="collapsible" data-collapsed="true">
                        <h3>
                            Compass
                        </h3>
                        <p id="deviceCompass">Loading device Compass...</p>
                    </div>
                </div>
            </div>
        </div>
        <div data-role="page" id="page3">
            <div data-theme="a" data-role="header" data-position="fixed">
                <a href="#pageHome" data-transition="fade" data-icon="home" data-iconpos="notext">Home</a>
                <h3>
                    Map
                </h3>
            </div>
            <div data-role="content">
                <img src="https://maps.googleapis.com/maps/api/staticmap?center=Madison,%20WI&amp;zoom=14&amp;size=288x200&amp;markers=Madison,%20WI&amp;sensor=false" height="200" width="288" />                
            </div>
        </div>
        <script>
            $(function(){

                // Wait for Cordova to load
                //
                document.addEventListener("deviceready", onDeviceReady, false);

                function onDeviceReady(){
                    updateDeviceStatus();
                }

                function updateDeviceStatus(){
                    deviceProperties();
                    checkConnection();
                    checkDeviceGPS();
					checkDeviceAccelerometer();
					checkDeviceCompass();
                }

                function deviceProperties(){
                    $('#deviceProperties').html('Device Name: '     + device.name     + '<br />' + 
                                                'Device Cordova: '  + device.cordova + '<br />' + 
                                                'Device Platform: ' + device.platform + '<br />' + 
                                                'Device UUID: '     + device.uuid     + '<br />' + 
                                                'Device Version: '  + device.version  + '<br />');

                }

                function checkConnection() {
                    var networkState = navigator.network.connection.type;

                    var states = {};
                    states[Connection.UNKNOWN]  = 'Unknown connection';
                    states[Connection.ETHERNET] = 'Ethernet connection';
                    states[Connection.WIFI]     = 'WiFi connection';
                    states[Connection.CELL_2G]  = 'Cell 2G connection';
                    states[Connection.CELL_3G]  = 'Cell 3G connection';
                    states[Connection.CELL_4G]  = 'Cell 4G connection';
                    states[Connection.NONE]     = 'No network connection';

                    $('#deviceConnectivity').html('Connection type: ' + states[networkState]);
                }


                function checkDeviceGPS(){

                    // onSuccess Geolocation
                    //
                    var onGeolocationSuccess = function(position) {
                        $('#deviceGPS').html('Latitude: '           + position.coords.latitude              + '<br />' +
                                                'Longitude: '          + position.coords.longitude             + '<br />' +
                                                'Altitude: '           + position.coords.altitude              + '<br />' +
                                                'Accuracy: '           + position.coords.accuracy              + '<br />' +
                                                'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                                                'Heading: '            + position.coords.heading               + '<br />' +
                                                'Speed: '              + position.coords.speed                 + '<br />' +
                                                'Timestamp: '          + new Date(position.timestamp)          + '<br />');
                    };
                    
                    // onError Callback receives a PositionError object
                    //
                    var onGeolocationError = function(error) {
                        $('#deviceGPS').html('code: '    + error.code    + '\n' +
                              'message: ' + error.message + '\n');
                    };

                    navigator.geolocation.getCurrentPosition(onGeolocationSuccess, onGeolocationError);
                }

				function checkDeviceAccelerometer(){
					var onSuccess = function(acceleration) {
						$('#deviceAccelerometer').html('Acceleration X: ' + acceleration.x + '\n' +
							  'Acceleration Y: ' + acceleration.y + '\n' +
							  'Acceleration Z: ' + acceleration.z + '\n' +
							  'Timestamp: '      + new Date(acceleration.timestamp) + '\n');
					};

					var onError = function() {
						$('#deviceAccelerometer').html('onError!');
					};

					navigator.accelerometer.getCurrentAcceleration(onSuccess, onError);
				}

				function checkDeviceCompass(){
					var onSuccess = function(acceleration) {
						$('#deviceCompass').html('Heading: ' + heading.magneticHeading);

					};

					var onError = function() {
						$('#deviceCompass').html('CompassError: ' + error.code);
					};

					navigator.compass.getCurrentHeading(onSuccess, onError);
				}

                $('body').on('click','#updateDeviceStatus',function(){                    
                    updateDeviceStatus();
                });
            });
        </script>
    </body>
</html>